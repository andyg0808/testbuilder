#!/usr/bin/env python3
import sys
from pathlib import Path
from shutil import copy
from subprocess import run
from typing import List

from docopt import docopt  # type: ignore

from runner import Runner

DOCS = """
Usage:
    run_test <program> <base> <target> <variant>...
"""


def main(program: str, base: str, target: str, variants: List[str]) -> None:
    t = CopyRunner(Path(base), target, program.split(" "))
    for variant in variants:
        res = t.run_test(Path(variant))
        if res.returncode != 0:
            print(res)
            sys.exit(2)
    print()


class CopyRunner(Runner[Path]):
    def get_variant(self, variant: Path, dest: Path) -> None:
        copy(variant, dest)


if __name__ == "__main__":
    opts = docopt(DOCS)
    program = opts["<program>"]
    base = opts["<base>"]
    target = opts["<target>"]
    variants = opts["<variant>"]
    main(program, base, target, variants)
